\rules(programRules:Java) {
    \lemma
    dominatesNotEqual {
        \schemaVar \term Object x, y;

        \assumes(dominates(x, y) ==>)
        \find(x = y)

        \sameUpdateLevel

        \replacewith(false)

        \heuristics(simplify)
    };

    \lemma
    dominatesNotEqualLeft {
        \schemaVar \term Object x, y;

        \assumes(dominates(x, y) ==>)
        \find(y = x)

        \sameUpdateLevel

        \replacewith(false)

        \heuristics(simplify)
        \displayname "dominatesNotEqual"
    };

    \lemma
    undomRefl {
        \schemaVar \term Object x, y;

        \find(undom(x, y))

        \replacewith(undom(y, x))
    };

    \lemma
    dominatesTransitive {
        \schemaVar \term Object x, y, z;
        \assumes(dominates(x, y) ==>)
        \find(dominates(y, z) ==>)
        \add(dominates(x, z) ==>)
        \heuristics(simplify)
    };

    \lemma
    closePeerDominate {
        \schemaVar \term Object x, y;

        \assumes(dominates(y, x) ==>)
        \find(dominates(x, y) ==>)
        \closegoal
        \heuristics(simplify)
    };

    \lemma
    dominatesAntisymm {
        \schemaVar \term Object x, y;
        \find(dominates(x, y) ==>)
        \add(==> x = y, dominates(y, x))
    };

    \lemma
    owns2Dominates {
        \schemaVar \term Object x, y;

        \find(owner(y) = x ==>)

        \add(dominates(x, y) ==>)
        \heuristics(simplify)
    };

    \lemma
    ownsSelf {
        \schemaVar \term Object o;

        \find(owner(o) = o)
        
        \replacewith(false)

        \heuristics(simplify)
    };


    \lemma
    closePeerOwn {
        \schemaVar \term Object x, y;

        \assumes(owner(x) = y ==>)
        \find(owner(y) = x ==>)
        \closegoal

        \heuristics(simplify)
    };

    \lemma
    sameLevelUndom {
        \schemaVar \term Object o, x, y;

        \assumes(owner(x) = o, owner(y) = o ==>)
        \find(==> x = y)

        \add(undom(x, y) ==>)
        \heuristics(simplify)
    };


    \lemma 
    repfpElement {
        \schemaVar \term Object x, y;
        \schemaVar \term Field f;

        \find(elementOf(x, f, repfp(y)))
        \replacewith(dominates(y, x) | x = y)
        \heuristics(simplify)
    };

    \lemma 
    dominatesInverse {
        \schemaVar \term Object x, y;

        \assumes(dominates(x, y) ==>)

        \find(dominates(y, x))

        \sameUpdateLevel

        \replacewith(false)
        \heuristics(simplify)
    };

    \lemma 
    repfpSubset {
        \schemaVar \term Object x, y;

        \assumes(dominates(x, y) ==>)

        \find(repfp(y))

        \sameUpdateLevel

        \add(subset(repfp(y), repfp(x)) ==>)
        \heuristics(simplify)
    };

    \lemma 
    dominatesNegTransitive {
        \schemaVar \term Object x, y, z;

        \assumes(dominates(x, z) ==> dominates(x, y))
        \find(dominates(z, y))
        \sameUpdateLevel
        \replacewith(false)
        \heuristics(simplify)
    };

    \lemma 
    dominatesNegNotEqual {
        \schemaVar \term Object x, y, z;

        \assumes(dominates(x, z) ==> dominates(x, y))
        \find(y = z)
        \sameUpdateLevel
        \replacewith(false)
        \heuristics(simplify)
    };

    \lemma 
    repfpDisjointComplement {
        \schemaVar \term Object x, y;

        \find(disjoint(setMinus(allLocs, repfp(x)), repfp(y)))

        \replacewith(x = y | dominates(x, y))
        \heuristics(simplify)
    };

    \lemma 
    createdRepfpDisjointComplementRepfp {
        \schemaVar \term Object x, y;
        \schemaVar \term Heap h;

        \assumes(boolean::select(h, y, java.lang.Object::<created>) = TRUE ==>)

        \find(disjoint(setMinus(allLocs, repfp(x)), createdRepfp(h, y)))
        \sameUpdateLevel

        \replacewith(x = y | dominates(x, y))
        \heuristics(simplify)
    };

    \lemma 
    createdRepfpDisjointComplement {
        \schemaVar \term Object x, y;
        \schemaVar \term Heap h;

        \assumes(boolean::select(h, x, java.lang.Object::<created>) = TRUE, boolean::select(h, y, java.lang.Object::<created>) = TRUE ==>)
        \find(disjoint(setMinus(allLocs, createdRepfp(h, x)), createdRepfp(h, y)))
        \sameUpdateLevel

        \replacewith(x = y | dominates(x, y))
        \heuristics(simplify)
    };

    \lemma 
    createdRepfpElement {
        \schemaVar \term Object x, y;
        \schemaVar \term Heap h;
        \schemaVar \term Field f;

        \find(elementOf(x, f, createdRepfp(h, y)))
        \replacewith((dominates(y, x) | x = y) & boolean::select(h, x, java.lang.Object::<created>) = TRUE)
        \heuristics(simplify)
    };

    \lemma
    dominatesSameNotUndom {
        \schemaVar \term Object x, y, z;

        \assumes(dominates(x, z) ==>)
        \find(dominates(y, z) ==>)

        \add(==> undom(x, y))
        \heuristics(simplify)
    };

    \lemma
    undomTransitive {
        \schemaVar \term Object x, y, z;

        \assumes(dominates(y, z) ==>)
        \find(undom(x, y) ==>)

        \add(undom(x, z) ==>)

        // do it by hand currently since there may be nicer ways to do that
        //\heuristics(simplify)
    };
}
