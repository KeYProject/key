
\rules(programRules:Java) {
    // ===============================
    //        Normal Variant
    // ===============================

    \lemma 
    dismissSelectOfDominatedObject {
        \schemaVar \term Heap h;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f1, f2;
        \schemaVar \term any x;

        \assumes(dominates(o, u) ==>)
        \find(alpha::select(store(h, o, f1, x), u, f2))
        \sameUpdateLevel

        \replacewith(alpha::select(h, u, f2))
        \heuristics(simplify)
    };

    \lemma 
    dismissSelectOfDominatedObjectEQ {
        \schemaVar \term Heap h, EQ;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f1, f2;
        \schemaVar \term any x;

        \assumes(store(h, o, f1, x) = EQ, dominates(o, u) ==>)
        \find(alpha::select(EQ, u, f2))
        \sameUpdateLevel

        \replacewith(alpha::select(h, u, f2))
        \heuristics(simplify)
    };

    \lemma 
    dismissSelectOfDominatingObject {
        \schemaVar \term Heap h;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f1, f2;
        \schemaVar \term any x;

        \assumes(dominates(u, o) ==>)
        \find(alpha::select(store(h, o, f1, x), u, f2))
        \sameUpdateLevel

        \replacewith(alpha::select(h, u, f2))
        \heuristics(simplify)
    };

    \lemma 
    dismissSelectOfDominatingObjectEQ {
        \schemaVar \term Heap h, EQ;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f1, f2;
        \schemaVar \term any x;

        \assumes(store(h, o, f1, x) = EQ, dominates(u, o) ==>)
        \find(alpha::select(EQ, u, f2))
        \sameUpdateLevel

        \replacewith(alpha::select(h, u, f2))
        \heuristics(simplify)
    };

    \lemma 
    dismissSelectOfDominatedAnon {
        \schemaVar \term Heap h, h2;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(boolean::select(h, o, java.lang.Object::<created>) = TRUE, dominates(o, u) ==>)
        \find(alpha::select(anon(h, repfp(u), h2), o, f))
        \sameUpdateLevel

        \replacewith(alpha::select(h, o, f))
        \heuristics(simplify)
    };

    \lemma 
    dismissSelectOfDominatedAnonEQ {
        \schemaVar \term Heap h, h2, EQ;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(boolean::select(h, o, java.lang.Object::<created>) = TRUE, anon(h, repfp(u), h2) = EQ, dominates(o, u) ==>)
        \find(alpha::select(EQ, o, f))
        \sameUpdateLevel

        \replacewith(alpha::select(h, o, f))
        \heuristics(simplify)
    };

    \lemma 
    dismissSelectOfDominatedCreatedAnon {
        \schemaVar \term Heap h, h2, h3;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(boolean::select(h, o, java.lang.Object::<created>) = TRUE, dominates(o, u) ==>)
        \find(alpha::select(anon(h, createdRepfp(h3, u), h2), o, f))
        \sameUpdateLevel

        \replacewith(alpha::select(h, o, f))
        \heuristics(simplify)
    };

    \lemma 
    dismissSelectOfDominatedCreatedAnonEQ {
        \schemaVar \term Heap h, h2, h3, EQ;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(boolean::select(h, o, java.lang.Object::<created>) = TRUE, anon(h, createdRepfp(h3, u), h2) = EQ, dominates(o, u) ==>)
        \find(alpha::select(EQ, o, f))
        \sameUpdateLevel

        \replacewith(alpha::select(h, o, f))
        \heuristics(simplify)
    };

    // ============================================
    //      Complement Rules (for accessible)
    // ============================================

    \lemma 
    dismissSelectOfSelfRepfpComplementAnon {
        \schemaVar \term Heap h, h2;
        \schemaVar \term Object o;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(boolean::select(h, o, java.lang.Object::<created>) = TRUE ==>)
        \find(alpha::select(anon(h, setMinus(allLocs, repfp(o)), h2), o, f))
        \sameUpdateLevel

        \replacewith(alpha::select(h, o, f))
        \heuristics(simplify)
    };

    \lemma 
    dismissSelectOfSelfCreatedRepfpComplementAnon {
        \schemaVar \term Heap h, h2, h3;
        \schemaVar \term Object o;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(boolean::select(h, o, java.lang.Object::<created>) = TRUE, boolean::select(h3, o, java.lang.Object::<created>) = TRUE ==>)
        \find(alpha::select(anon(h, setMinus(allLocs, createdRepfp(h3, o)), h2), o, f))
        \sameUpdateLevel

        \replacewith(alpha::select(h, o, f))
        \heuristics(simplify)
    };

    \lemma 
    dismissSelectOfDominatingRepfpComplementAnon {
        \schemaVar \term Heap h, h2;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(boolean::select(h, o, java.lang.Object::<created>) = TRUE, dominates(u, o) ==>)
        \find(alpha::select(anon(h, setMinus(allLocs, repfp(u)), h2), o, f))
        \sameUpdateLevel

        \replacewith(alpha::select(h, o, f))
        \heuristics(simplify)
    };

    \lemma 
    dismissSelectOfDominatingCreatedRepfpComplementAnon {
        \schemaVar \term Heap h, h2, h3;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(boolean::select(h, o, java.lang.Object::<created>) = TRUE, boolean::select(h3, o, java.lang.Object::<created>) = TRUE, dominates(u, o) ==>)
        \find(alpha::select(anon(h, setMinus(allLocs, createdRepfp(h3, u)), h2), o, f))
        \sameUpdateLevel

        \replacewith(alpha::select(h, o, f))
        \heuristics(simplify)
    };

    // -------------------------------------
    // EQ rules

    \lemma 
    dismissSelectOfSelfRepfpComplementAnonEQ {
        \schemaVar \term Heap h, h2, EQ;
        \schemaVar \term Object o;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(boolean::select(h, o, java.lang.Object::<created>) = TRUE, anon(h, setMinus(allLocs, repfp(o)), h2) = EQ ==>)
        \find(alpha::select(EQ, o, f))
        \sameUpdateLevel

        \replacewith(alpha::select(h, o, f))
        \heuristics(simplify)
    };

    \lemma 
    dismissSelectOfSelfCreatedRepfpComplementAnonEQ {
        \schemaVar \term Heap h, h2, h3, EQ;
        \schemaVar \term Object o;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(boolean::select(h, o, java.lang.Object::<created>) = TRUE, boolean::select(h3, o, java.lang.Object::<created>) = TRUE, anon(h, setMinus(allLocs, createdRepfp(h3, o)), h2) = EQ ==>)
        \find(alpha::select(EQ, o, f))
        \sameUpdateLevel

        \replacewith(alpha::select(h, o, f))
        \heuristics(simplify)
    };

    \lemma 
    dismissSelectOfDominatingRepfpComplementAnonEQ {
        \schemaVar \term Heap h, h2, EQ;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(boolean::select(h, o, java.lang.Object::<created>) = TRUE, dominates(u, o), anon(h, setMinus(allLocs, repfp(u)), h2) = EQ ==>)
        \find(alpha::select(EQ, o, f))
        \sameUpdateLevel

        \replacewith(alpha::select(h, o, f))
        \heuristics(simplify)
    };

    \lemma 
    dismissSelectOfDominatingCreatedRepfpComplementAnonEQ {
        \schemaVar \term Heap h, h2, h3, EQ;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(boolean::select(h, o, java.lang.Object::<created>) = TRUE, boolean::select(h3, o, java.lang.Object::<created>) = TRUE, dominates(u, o), anon(h, setMinus(allLocs, createdRepfp(h3, u)), h2) = EQ ==>)
        \find(alpha::select(EQ, o, f))
        \sameUpdateLevel

        \replacewith(alpha::select(h, o, f))
        \heuristics(simplify)
    };

// ========================================================
// ========================================================
// ========================================================
// ========================================================
// ========================================================


    // ===============================
    //        Normal Variant
    // ===============================

    \lemma 
    simplifySelectOfDominatedAnon {
        \schemaVar \term Heap h, h2;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(dominates(o, u) ==> o = null)
        \find(alpha::select(anon(h, repfp(u), h2), o, f))
        \sameUpdateLevel

        \replacewith(\if(boolean::select(h, o, java.lang.Object::<created>) = TRUE) 
            \then(alpha::select(h, o, f)) 
            \else(alpha::select(h2, o, f)))
        \heuristics(simplify)
    };

    \lemma 
    simplifySelectOfDominatedCreatedAnon {
        \schemaVar \term Heap h, h2, h3;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(dominates(o, u) ==> o = null)
        \find(alpha::select(anon(h, createdRepfp(h3, u), h2), o, f))
        \sameUpdateLevel

        \replacewith(\if(boolean::select(h, o, java.lang.Object::<created>) = TRUE) 
            \then(alpha::select(h, o, f)) 
            \else(alpha::select(h2, o, f)))
        \heuristics(simplify)
    };

    // --------------------------------------------
    // EQ Rules

    \lemma 
    simplifySelectOfDominatedAnonEQ {
        \schemaVar \term Heap h, h2, EQ;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(anon(h, repfp(u), h2) = EQ, dominates(o, u) ==> o = null)
        \find(alpha::select(EQ, o, f))
        \sameUpdateLevel

        \replacewith(\if(boolean::select(h, o, java.lang.Object::<created>) = TRUE) 
            \then(alpha::select(h, o, f)) 
            \else(alpha::select(h2, o, f)))
        \heuristics(simplify)
    };

    \lemma 
    simplifySelectOfDominatedCreatedAnonEQ {
        \schemaVar \term Heap h, h2, h3, EQ;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(anon(h, createdRepfp(h3, u), h2) = EQ, dominates(o, u) ==> o = null)
        \find(alpha::select(EQ, o, f))
        \sameUpdateLevel

        \replacewith(\if(boolean::select(h, o, java.lang.Object::<created>) = TRUE) 
            \then(alpha::select(h, o, f)) 
            \else(alpha::select(h2, o, f)))
        \heuristics(simplify)
    };

    // ============================================
    //      Complement Rules (for accessible)
    // ============================================

    \lemma 
    simplifySelectOfSelfRepfpComplementAnon {
        \schemaVar \term Heap h, h2;
        \schemaVar \term Object o;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(==> o = null)

        \find(alpha::select(anon(h, setMinus(allLocs, repfp(o)), h2), o, f))
        \sameUpdateLevel

        \replacewith(\if(boolean::select(h, o, java.lang.Object::<created>) = TRUE)
            \then(alpha::select(h, o, f))
            \else(alpha::select(h2, o, f)))
        \heuristics(simplify)
    };

    \lemma 
    simplifySelectOfSelfRepfpComplementAnonEQ {
        \schemaVar \term Heap h, h2, EQ;
        \schemaVar \term Object o;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(anon(h, setMinus(allLocs, repfp(o)), h2) = EQ ==> o = null)
        \find(alpha::select(EQ, o, f))
        \sameUpdateLevel

        \replacewith(\if(boolean::select(h, o, java.lang.Object::<created>) = TRUE)
            \then(alpha::select(h, o, f))
            \else(alpha::select(h2, o, f)))
        \heuristics(simplify)
    };

    \lemma 
    simplifySelectOfSelfCreatedRepfpComplementAnon {
        \schemaVar \term Heap h, h2, h3;
        \schemaVar \term Object o;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(==> o = null)
        \find(alpha::select(anon(h, setMinus(allLocs, createdRepfp(h3, o)), h2), o, f))
        \sameUpdateLevel

        \replacewith(\if(boolean::select(h, o, java.lang.Object::<created>) = TRUE & 
              (boolean::select(h3, o, java.lang.Object::<created>) = TRUE | f = java.lang.Object::<created>))
            \then(alpha::select(h, o, f))
            \else(alpha::select(h2, o, f)))
        \heuristics(simplify)
    };

    \lemma 
    simplifySelectOfSelfCreatedRepfpComplementAnonEQ {
        \schemaVar \term Heap h, h2, h3, EQ;
        \schemaVar \term Object o;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(anon(h, setMinus(allLocs, createdRepfp(h3, o)), h2) = EQ ==> o = null)
        \find(alpha::select(EQ, o, f))
        \sameUpdateLevel

        \replacewith(\if(boolean::select(h, o, java.lang.Object::<created>) = TRUE & 
              (boolean::select(h3, o, java.lang.Object::<created>) = TRUE | f = java.lang.Object::<created>))
            \then(alpha::select(h, o, f))
            \else(alpha::select(h2, o, f)))
        \heuristics(simplify)
    };

    \lemma 
    simplifySelectOfDominatingRepfpComplementAnon {
        \schemaVar \term Heap h, h2;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(dominates(u, o) ==> o = null)
        \find(alpha::select(anon(h, setMinus(allLocs, repfp(u)), h2), o, f))
        \sameUpdateLevel

        \replacewith(\if(boolean::select(h, o, java.lang.Object::<created>) = TRUE)
            \then(alpha::select(h, o, f))
            \else(alpha::select(h2, o, f)))
        \heuristics(simplify)
    };

    \lemma 
    simplifySelectOfDominatingRepfpComplementAnonEQ {
        \schemaVar \term Heap h, h2, EQ;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(dominates(u, o), anon(h, setMinus(allLocs, repfp(u)), h2) = EQ ==> o = null)
        \find(alpha::select(EQ, o, f))
        \sameUpdateLevel

        \replacewith(\if(boolean::select(h, o, java.lang.Object::<created>) = TRUE)
            \then(alpha::select(h, o, f))
            \else(alpha::select(h2, o, f)))
        \heuristics(simplify)
    };

    \lemma 
    simplifySelectOfDominatingCreatedRepfpComplementAnon {
        \schemaVar \term Heap h, h2, h3;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(dominates(u, o) ==> o = null)
        \find(alpha::select(anon(h, setMinus(allLocs, createdRepfp(h3, u)), h2), o, f))
        \sameUpdateLevel

        \replacewith(\if(boolean::select(h, o, java.lang.Object::<created>) = TRUE & 
              (boolean::select(h3, o, java.lang.Object::<created>) = TRUE | f = java.lang.Object::<created>))
            \then(alpha::select(h, o, f))
            \else(alpha::select(h2, o, f)))
        \heuristics(simplify)
    };

    \lemma 
    simplifySelectOfDominatingCreatedRepfpComplementAnonEQ {
        \schemaVar \term Heap h, h2, h3, EQ;
        \schemaVar \term Object o, u;
        \schemaVar \term Field f;
        \schemaVar \term any x;

        \assumes(dominates(u, o), anon(h, setMinus(allLocs, createdRepfp(h3, u)), h2) = EQ ==> o = null)
        \find(alpha::select(EQ, o, f))
        \sameUpdateLevel

        \replacewith(\if(boolean::select(h, o, java.lang.Object::<created>) = TRUE & 
              (boolean::select(h3, o, java.lang.Object::<created>) = TRUE | f = java.lang.Object::<created>))
            \then(alpha::select(h, o, f))
            \else(alpha::select(h2, o, f)))
        \heuristics(simplify)
    };
}
